<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>eks - Amazon EKS &mdash; Hydroplane  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/autodoc_pydantic.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Defining Secrets" href="../secrets.html" />
    <link rel="prev" title="docker - Docker (Single-Node) Runtime" href="docker.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Hydroplane
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using-hydroplane.html">How to Use Hydroplane</a></li>
<li class="toctree-l1"><a class="reference internal" href="../settings.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../processes.html">Defining Processes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../runtimes.html">Runtimes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="docker.html"><code class="docutils literal notranslate"><span class="pre">docker</span></code> - Docker (Single-Node) Runtime</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">eks</span></code> - Amazon EKS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#settings">Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-configuration">Example Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#quickstart">Quickstart</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-create-an-eks-cluster-and-iam-user">Step 1: Create an EKS cluster and IAM user</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-configure-hydroplane">Step 2: Configure Hydroplane</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-run-hydroplane">Step 3: Run Hydroplane</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#implementation-and-configuration-details">Implementation and Configuration Details</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-the-eks-runtime-creates-processes">How the <code class="docutils literal notranslate"><span class="pre">eks</span></code> Runtime Creates Processes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#authenticating-with-aws">Authenticating with AWS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#authenticating-with-iam-credentials">Authenticating with IAM Credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="#authenticating-with-role-assumption">Authenticating with Role Assumption</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-note-on-iam-user-permissions">A Note on IAM User Permissions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-hydroplane.models.aws">AWS Authentication Configuration Reference</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../secrets.html">Defining Secrets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Hydroplane</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../runtimes.html">Runtimes</a> &raquo;</li>
      <li><code class="docutils literal notranslate"><span class="pre">eks</span></code> - Amazon EKS</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/runtimes/eks.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="eks-amazon-eks">
<h1><a class="toc-backref" href="#id1"><code class="docutils literal notranslate"><span class="pre">eks</span></code> - Amazon EKS</a><a class="headerlink" href="#eks-amazon-eks" title="Permalink to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">eks</span></code> runtime integrates with EKS, AWS’s managed Kubernetes offering.</p>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#eks-amazon-eks" id="id1"><code class="docutils literal notranslate"><span class="pre">eks</span></code> - Amazon EKS</a></p>
<ul>
<li><p><a class="reference internal" href="#settings" id="id2">Settings</a></p></li>
<li><p><a class="reference internal" href="#example-configuration" id="id3">Example Configuration</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#quickstart" id="id4">Quickstart</a></p>
<ul>
<li><p><a class="reference internal" href="#step-1-create-an-eks-cluster-and-iam-user" id="id5">Step 1: Create an EKS cluster and IAM user</a></p></li>
<li><p><a class="reference internal" href="#step-2-configure-hydroplane" id="id6">Step 2: Configure Hydroplane</a></p></li>
<li><p><a class="reference internal" href="#step-3-run-hydroplane" id="id7">Step 3: Run Hydroplane</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#implementation-and-configuration-details" id="id8">Implementation and Configuration Details</a></p>
<ul>
<li><p><a class="reference internal" href="#how-the-eks-runtime-creates-processes" id="id9">How the <code class="docutils literal notranslate"><span class="pre">eks</span></code> Runtime Creates Processes</a></p></li>
<li><p><a class="reference internal" href="#authenticating-with-aws" id="id10">Authenticating with AWS</a></p>
<ul>
<li><p><a class="reference internal" href="#authenticating-with-iam-credentials" id="id11">Authenticating with IAM Credentials</a></p></li>
<li><p><a class="reference internal" href="#authenticating-with-role-assumption" id="id12">Authenticating with Role Assumption</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#a-note-on-iam-user-permissions" id="id13">A Note on IAM User Permissions</a></p></li>
<li><p><a class="reference internal" href="#module-hydroplane.models.aws" id="id14">AWS Authentication Configuration Reference</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="settings">
<h2><a class="toc-backref" href="#id2">Settings</a><a class="headerlink" href="#settings" title="Permalink to this heading"></a></h2>
<dl class="py class pydantic_model">
<dt class="sig sig-object py" id="hydroplane.runtimes.eks.Settings">
<em class="property"><span class="pre">pydantic</span> <span class="pre">model</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hydroplane.runtimes.eks.</span></span><span class="sig-name descname"><span class="pre">Settings</span></span><a class="headerlink" href="#hydroplane.runtimes.eks.Settings" title="Permalink to this definition"></a></dt>
<dd><dl class="py attribute pydantic_field">
<dt class="sig sig-object py" id="hydroplane.runtimes.eks.Settings.runtime_type">
<em class="property"><span class="pre">field</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">runtime_type</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'eks'</span></span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'eks'</span></em><a class="headerlink" href="#hydroplane.runtimes.eks.Settings.runtime_type" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute pydantic_field">
<dt class="sig sig-object py" id="hydroplane.runtimes.eks.Settings.credentials">
<em class="property"><span class="pre">field</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">credentials</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#hydroplane.models.aws.AWSCredentials" title="hydroplane.models.aws.AWSCredentials"><span class="pre">AWSCredentials</span></a></em><em class="property"> <span class="pre">[Required]</span></em><a class="headerlink" href="#hydroplane.runtimes.eks.Settings.credentials" title="Permalink to this definition"></a></dt>
<dd><p>the credentials that will be used to authenticate with EKS</p>
</dd></dl>

<dl class="py attribute pydantic_field">
<dt class="sig sig-object py" id="hydroplane.runtimes.eks.Settings.cluster_name">
<em class="property"><span class="pre">field</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">cluster_name</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><em class="property"> <span class="pre">[Required]</span></em><a class="headerlink" href="#hydroplane.runtimes.eks.Settings.cluster_name" title="Permalink to this definition"></a></dt>
<dd><p>the name of the EKS cluster</p>
</dd></dl>

<dl class="py attribute pydantic_field">
<dt class="sig sig-object py" id="hydroplane.runtimes.eks.Settings.region">
<em class="property"><span class="pre">field</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">region</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><em class="property"> <span class="pre">[Required]</span></em><a class="headerlink" href="#hydroplane.runtimes.eks.Settings.region" title="Permalink to this definition"></a></dt>
<dd><p>the AWS region where the cluster is running (e.g. us-west-2)</p>
</dd></dl>

<dl class="py attribute pydantic_field">
<dt class="sig sig-object py" id="hydroplane.runtimes.eks.Settings.namespace">
<em class="property"><span class="pre">field</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">namespace</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'default'</span></em><a class="headerlink" href="#hydroplane.runtimes.eks.Settings.namespace" title="Permalink to this definition"></a></dt>
<dd><p>the Kubernetes namespace that Hydroplane will create pods and services within</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="example-configuration">
<h2><a class="toc-backref" href="#id3">Example Configuration</a><a class="headerlink" href="#example-configuration" title="Permalink to this heading"></a></h2>
<p>Here’s an example of a configuration file that uses the <code class="docutils literal notranslate"><span class="pre">eks</span></code> runtime and the <code class="docutils literal notranslate"><span class="pre">local</span></code> secret store. This configuration sets up Hydroplane to talk to an EKS cluster named <code class="docutils literal notranslate"><span class="pre">my-cool-cluster</span></code> in the <code class="docutils literal notranslate"><span class="pre">us-west-2</span></code> AWS region:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span><span class="w"></span>
<span class="nt">secret_store</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">secret_store_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span><span class="w"></span>
<span class="w">  </span><span class="nt">store_location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~/.hydro_secrets</span><span class="w"></span>

<span class="nt">runtime</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">runtime_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eks</span><span class="w"></span>
<span class="w">  </span><span class="nt">cluster_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-cool-cluster</span><span class="w"></span>
<span class="w">  </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-west-2</span><span class="w"></span>
<span class="w">  </span><span class="nt">credentials</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">access_key</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">access_key_id</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">secret_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-credentials</span><span class="w"></span>
<span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AccessKeyId</span><span class="w"></span>
<span class="w">      </span><span class="nt">secret_access_key</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">secret_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-credentials</span><span class="w"></span>
<span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SecretAccessKey</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="quickstart">
<h1><a class="toc-backref" href="#id4">Quickstart</a><a class="headerlink" href="#quickstart" title="Permalink to this heading"></a></h1>
<div class="section" id="step-1-create-an-eks-cluster-and-iam-user">
<h2><a class="toc-backref" href="#id5">Step 1: Create an EKS cluster and IAM user</a><a class="headerlink" href="#step-1-create-an-eks-cluster-and-iam-user" title="Permalink to this heading"></a></h2>
<p>In order to use the <code class="docutils literal notranslate"><span class="pre">eks</span></code> runtime, you first have to have an EKS cluster. We’ll use `` <a href="#id15"><span class="problematic" id="id16">`hydro-project/eks-setup&lt;https://github.com/hydro-project/eks-setup&gt;`_</span></a> `` to do that. Follow the instructions in the “Quickstart” section of that repo’s README.</p>
<p>When you’re done with those instructions, you should have two things:</p>
<ul class="simple">
<li><p>An EKS cluster (we’ll assume that the cluster’s name is <code class="docutils literal notranslate"><span class="pre">hydro-eks</span></code> and that it was created in <code class="docutils literal notranslate"><span class="pre">us-west-2</span></code> in subsequent steps for brevity)</p></li>
<li><p>The access key and secret key for a user in the cluster’s <code class="docutils literal notranslate"><span class="pre">cluster-admins</span></code> group (if you added a user using <code class="docutils literal notranslate"><span class="pre">eks-setup</span> <span class="pre">user</span> <span class="pre">add</span></code>, that user is in the <code class="docutils literal notranslate"><span class="pre">cluster-admins</span></code> group)</p></li>
</ul>
</div>
<div class="section" id="step-2-configure-hydroplane">
<h2><a class="toc-backref" href="#id6">Step 2: Configure Hydroplane</a><a class="headerlink" href="#step-2-configure-hydroplane" title="Permalink to this heading"></a></h2>
<p>Create a file named <code class="docutils literal notranslate"><span class="pre">eks.yml</span></code> with the following contents:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span><span class="w"></span>
<span class="nt">secret_store</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">secret_store_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span><span class="w"></span>
<span class="w">  </span><span class="nt">store_location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~/.hydro_secrets</span><span class="w"></span>

<span class="nt">runtime</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">runtime_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eks</span><span class="w"></span>
<span class="w">  </span><span class="nt">cluster_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hydro-eks</span><span class="w"></span>
<span class="w">  </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-west-2</span><span class="w"></span>
<span class="w">  </span><span class="nt">credentials</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">access_key</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">access_key_id</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">secret_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-credentials</span><span class="w"></span>
<span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AccessKeyId</span><span class="w"></span>
<span class="w">      </span><span class="nt">secret_access_key</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">secret_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-credentials</span><span class="w"></span>
<span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SecretAccessKey</span><span class="w"></span>
</pre></div>
</div>
<p>If you haven’t already, initialize your local secret store:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bin/local-secret-store init
</pre></div>
</div>
<p>Make a note of the password you used when configuring the store; you’ll need it when Hydroplane starts.</p>
<p>Now, create a file called <code class="docutils literal notranslate"><span class="pre">creds.json</span></code> that looks like this:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;AccessKeyId&quot;</span><span class="p">:</span><span class="s2">&quot;&lt;put your user&#39;s access key ID here&gt;&quot;</span><span class="p">,</span><span class="nt">&quot;SecretAccessKey&quot;</span><span class="p">:</span><span class="s2">&quot;&lt;put your user&#39;s secret access key here&gt;&quot;</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Add that file to the secret store:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bin/local-secret-store add -f creds.json aws-credentials
</pre></div>
</div>
<p>and delete the plaintext original afterwards:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rm creds.json
</pre></div>
</div>
</div>
<div class="section" id="step-3-run-hydroplane">
<h2><a class="toc-backref" href="#id7">Step 3: Run Hydroplane</a><a class="headerlink" href="#step-3-run-hydroplane" title="Permalink to this heading"></a></h2>
<p>Now you’ve (finally) got an EKS cluster and the ability to authenticate to it! Let’s launch Hydroplane:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bin/hydroplane -c eks.yml
</pre></div>
</div>
<p>In a separate terminal, from the root of the <code class="docutils literal notranslate"><span class="pre">hydroplane</span></code> repo, let’s make sure we can list processes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bin/hpctl list
</pre></div>
</div>
<p>You should get back an empty list, because we haven’t launched any processes yet.</p>
<p>Let’s try a simple example to make sure we can start something and access it remotely:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bin/hpctl start examples/nginx.json
</pre></div>
</div>
<p>If you list processes with <code class="docutils literal notranslate"><span class="pre">bin/hpctl</span> <span class="pre">list</span></code> now, you should see something like this:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;process_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;nginx&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;group&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;socket_addresses&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;34.217.208.197&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">31491</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;is_public&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2022-12-01T22:40:33+00:00&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">]</span><span class="w"></span>
</pre></div>
</div>
<p>Note that the process is exposing a single public port. In this example, it’s <code class="docutils literal notranslate"><span class="pre">34.217.208.197:31491</span></code>, but your host and port will be different.</p>
<p>Once you’ve found that host and port, open the host and port in a web browser. You should see an <a class="reference external" href="https://www.nginx.com/">nginx</a> “hello world” page.</p>
<p>Let’s stop the process now that we’ve verified that everything is working:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bin/hpctl stop nginx
</pre></div>
</div>
</div>
</div>
<div class="section" id="implementation-and-configuration-details">
<h1><a class="toc-backref" href="#id8">Implementation and Configuration Details</a><a class="headerlink" href="#implementation-and-configuration-details" title="Permalink to this heading"></a></h1>
<div class="section" id="how-the-eks-runtime-creates-processes">
<h2><a class="toc-backref" href="#id9">How the <code class="docutils literal notranslate"><span class="pre">eks</span></code> Runtime Creates Processes</a><a class="headerlink" href="#how-the-eks-runtime-creates-processes" title="Permalink to this heading"></a></h2>
<p>Each process is run in EKS as a single pod and an associated service. The service is there to give Kubernetes something to expose to the Internet when a process has a public IP address, and to give processes an easy way to name one another without relying on any kind of third-party service discovery mechanism. Private services only need to be routable and discoverable within the cluster, so their associated services are <code class="docutils literal notranslate"><span class="pre">ClusterIP</span></code> services. Public services, on the other hand, need to be routable from outside the cluster. In a typical Kubernetes service (where you have one service backing an auto-scaling collection of pods), you’d use a <code class="docutils literal notranslate"><span class="pre">LoadBalancer</span></code> service. This would be wasteful if we did it for each process, however, since <code class="docutils literal notranslate"><span class="pre">LoadBalancer</span></code> services create associated load balancers, and load balancers in AWS are really expensive. Instead, we create a <code class="docutils literal notranslate"><span class="pre">NodePort</span></code> service for each process, which exposes the service on every node in the cluster at a certain high-numbered port. This means that a client could technically talk to the service by communicating with any cluster node, but that doesn’t quite mesh with Hydroplane’s process abstraction. To maintain the illusion that the process is only accessible via a single IP address, the runtime only returns the public IP address of the node on which the process’s associated pod is running when listing processes.</p>
</div>
<div class="section" id="authenticating-with-aws">
<h2><a class="toc-backref" href="#id10">Authenticating with AWS</a><a class="headerlink" href="#authenticating-with-aws" title="Permalink to this heading"></a></h2>
<p>In order for Hydroplane to launch processes on an EKS cluster, it must be able to authenticate with that cluster. To authenticate, you’ll need an AWS <a class="reference external" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html">access key ID and corresponding secret access key</a>. These credentials will need to be stored in Hydroplane’s <a class="reference internal" href="../secrets.html"><span class="doc">secret store</span></a>.</p>
<div class="section" id="authenticating-with-iam-credentials">
<span id="eks-secret-example"></span><h3><a class="toc-backref" href="#id11">Authenticating with IAM Credentials</a><a class="headerlink" href="#authenticating-with-iam-credentials" title="Permalink to this heading"></a></h3>
<p>Here’s an example configuration that uses a secret stored in Hydroplane’s secret store to authenticate with EKS. This config uses a secret named <code class="docutils literal notranslate"><span class="pre">aws-creds</span></code> that’s stored in the secret store as a JSON object like so:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;AccessKeyId&quot;</span><span class="p">:</span><span class="s2">&quot;XXXXXXXXX&quot;</span><span class="p">,</span><span class="nt">&quot;SecretAccessKey&quot;</span><span class="p">:</span><span class="s2">&quot;XXXXXXX&quot;</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>These related credentials are referenced individually using the <code class="docutils literal notranslate"><span class="pre">key</span></code> field.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">runtime</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">runtime_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eks</span><span class="w"></span>
<span class="w">    </span><span class="nt">cluster_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-cluster</span><span class="w"></span>
<span class="w">    </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-west-2</span><span class="w"></span>
<span class="w">    </span><span class="nt">credentials</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">access_key</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">access_key_id</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">secret_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-creds</span><span class="w"></span>
<span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AccessKeyId</span><span class="w"></span>
<span class="w">        </span><span class="nt">secret_access_key</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">secret_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-creds</span><span class="w"></span>
<span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SecretAccessKey</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="authenticating-with-role-assumption">
<h3><a class="toc-backref" href="#id12">Authenticating with Role Assumption</a><a class="headerlink" href="#authenticating-with-role-assumption" title="Permalink to this heading"></a></h3>
<p>While nothing stops you from authenticating directly with an access key and secret, it’s generally considered a best practice to authenticate using <a class="reference external" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_use-resources.html#using-temp-creds-sdk-cli">temporary IAM credentials</a>. These credentials are associated with a given IAM role, and expire after a certain period of time. Hydroplane will attempt to automatically renew these temporary credentials periodically.</p>
<p>Here’s an example of using the <code class="docutils literal notranslate"><span class="pre">aws-creds</span></code> secret from above to authenticate and then assume the role <code class="docutils literal notranslate"><span class="pre">EKSAdmin</span></code>. Most of this configuration will look familiar if you’ve looked at the configuration in the last section, but we’ve added an <code class="docutils literal notranslate"><span class="pre">assume_role</span></code> block to define the role assumption.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">runtime</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">runtime_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eks</span><span class="w"></span>
<span class="w">    </span><span class="nt">cluster_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-cluster</span><span class="w"></span>
<span class="w">    </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-west-2</span><span class="w"></span>
<span class="w">    </span><span class="nt">credentials</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">access_key</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">access_key_id</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">secret_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-creds</span><span class="w"></span>
<span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AccessKeyId</span><span class="w"></span>
<span class="w">        </span><span class="nt">secret_access_key</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">secret_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-creds</span><span class="w"></span>
<span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SecretAccessKey</span><span class="w"></span>
<span class="w">      </span><span class="w w-Error"> </span><span class="nt">assume_role</span><span class="p">:</span><span class="w"></span>
<span class="w">         </span><span class="nt">role_arn</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;arn:aws:iam::123456789012:role/EKSAdmin&quot;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-note-on-iam-user-permissions">
<h2><a class="toc-backref" href="#id13">A Note on IAM User Permissions</a><a class="headerlink" href="#a-note-on-iam-user-permissions" title="Permalink to this heading"></a></h2>
<p>The authenticating IAM user must have enough permissions on the EKS cluster to create and destroy pods and services. If you’ve set up your cluster with <a class="reference external" href="https://github.com/hydro-project/eks-setup">hydro-project/eks-setup</a>, then any user you add using that script will have the appropriate privileges.</p>
</div>
<div class="section" id="module-hydroplane.models.aws">
<span id="aws-authentication-configuration-reference"></span><h2><a class="toc-backref" href="#id14">AWS Authentication Configuration Reference</a><a class="headerlink" href="#module-hydroplane.models.aws" title="Permalink to this heading"></a></h2>
<dl class="py class pydantic_model">
<dt class="sig sig-object py" id="hydroplane.models.aws.AWSAccessKey">
<em class="property"><span class="pre">pydantic</span> <span class="pre">model</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hydroplane.models.aws.</span></span><span class="sig-name descname"><span class="pre">AWSAccessKey</span></span><a class="headerlink" href="#hydroplane.models.aws.AWSAccessKey" title="Permalink to this definition"></a></dt>
<dd><p>An AWS access key/secret key pair, used to authenticate with AWS.</p>
<dl class="py attribute pydantic_field">
<dt class="sig sig-object py" id="hydroplane.models.aws.AWSAccessKey.access_key_id">
<em class="property"><span class="pre">field</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">access_key_id</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="../secrets.html#hydroplane.models.secret.HydroplaneSecret" title="hydroplane.models.secret.HydroplaneSecret"><span class="pre">HydroplaneSecret</span></a></em><em class="property"> <span class="pre">[Required]</span></em><a class="headerlink" href="#hydroplane.models.aws.AWSAccessKey.access_key_id" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute pydantic_field">
<dt class="sig sig-object py" id="hydroplane.models.aws.AWSAccessKey.secret_access_key">
<em class="property"><span class="pre">field</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">secret_access_key</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="../secrets.html#hydroplane.models.secret.HydroplaneSecret" title="hydroplane.models.secret.HydroplaneSecret"><span class="pre">HydroplaneSecret</span></a></em><em class="property"> <span class="pre">[Required]</span></em><a class="headerlink" href="#hydroplane.models.aws.AWSAccessKey.secret_access_key" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class pydantic_model">
<dt class="sig sig-object py" id="hydroplane.models.aws.AWSAssumeRole">
<em class="property"><span class="pre">pydantic</span> <span class="pre">model</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hydroplane.models.aws.</span></span><span class="sig-name descname"><span class="pre">AWSAssumeRole</span></span><a class="headerlink" href="#hydroplane.models.aws.AWSAssumeRole" title="Permalink to this definition"></a></dt>
<dd><p>Information necessary for an AWS principal to temporarily assume a role (with associated
temporary credentials).</p>
<dl class="py attribute pydantic_field">
<dt class="sig sig-object py" id="hydroplane.models.aws.AWSAssumeRole.role_arn">
<em class="property"><span class="pre">field</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">role_arn</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><em class="property"> <span class="pre">[Required]</span></em><a class="headerlink" href="#hydroplane.models.aws.AWSAssumeRole.role_arn" title="Permalink to this definition"></a></dt>
<dd><p>the fully-qualified ARN of the role to assume</p>
</dd></dl>

<dl class="py attribute pydantic_field">
<dt class="sig sig-object py" id="hydroplane.models.aws.AWSAssumeRole.external_id">
<em class="property"><span class="pre">field</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">external_id</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../secrets.html#hydroplane.models.secret.HydroplaneSecret" title="hydroplane.models.secret.HydroplaneSecret"><span class="pre">HydroplaneSecret</span></a><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#hydroplane.models.aws.AWSAssumeRole.external_id" title="Permalink to this definition"></a></dt>
<dd><p>if needed, the external ID used to validate access to the role</p>
</dd></dl>

<dl class="py attribute pydantic_field">
<dt class="sig sig-object py" id="hydroplane.models.aws.AWSAssumeRole.session_name">
<em class="property"><span class="pre">field</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">session_name</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#hydroplane.models.aws.AWSAssumeRole.session_name" title="Permalink to this definition"></a></dt>
<dd><p>the name of the temporary session created by the role assumption</p>
</dd></dl>

<dl class="py attribute pydantic_field">
<dt class="sig sig-object py" id="hydroplane.models.aws.AWSAssumeRole.session_duration_seconds">
<em class="property"><span class="pre">field</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">session_duration_seconds</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">ConstrainedIntValue</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">900</span></em><a class="headerlink" href="#hydroplane.models.aws.AWSAssumeRole.session_duration_seconds" title="Permalink to this definition"></a></dt>
<dd><p>the duration of the temporary session, in seconds</p>
<dl class="field-list simple">
<dt class="field-odd">Constraints</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>minimum</strong> = 900</p></li>
<li><p><strong>maximum</strong> = 43200</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class pydantic_model">
<dt class="sig sig-object py" id="hydroplane.models.aws.AWSCredentials">
<em class="property"><span class="pre">pydantic</span> <span class="pre">model</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hydroplane.models.aws.</span></span><span class="sig-name descname"><span class="pre">AWSCredentials</span></span><a class="headerlink" href="#hydroplane.models.aws.AWSCredentials" title="Permalink to this definition"></a></dt>
<dd><p>Credentials used to authenticate with AWS.</p>
<dl class="py attribute pydantic_field">
<dt class="sig sig-object py" id="hydroplane.models.aws.AWSCredentials.access_key">
<em class="property"><span class="pre">field</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">access_key</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#hydroplane.models.aws.AWSAccessKey" title="hydroplane.models.aws.AWSAccessKey"><span class="pre">AWSAccessKey</span></a></em><em class="property"> <span class="pre">[Required]</span></em><a class="headerlink" href="#hydroplane.models.aws.AWSCredentials.access_key" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute pydantic_field">
<dt class="sig sig-object py" id="hydroplane.models.aws.AWSCredentials.assume_role">
<em class="property"><span class="pre">field</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">assume_role</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#hydroplane.models.aws.AWSAssumeRole" title="hydroplane.models.aws.AWSAssumeRole"><span class="pre">AWSAssumeRole</span></a><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#hydroplane.models.aws.AWSCredentials.assume_role" title="Permalink to this definition"></a></dt>
<dd><p>the role that Hydroplane will assume when communicating with AWS</p>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="docker.html" class="btn btn-neutral float-left" title="docker - Docker (Single-Node) Runtime" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../secrets.html" class="btn btn-neutral float-right" title="Defining Secrets" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Hydro Project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>